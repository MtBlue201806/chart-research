# chart-research

ここではJavaScriptでChartを実装できるライブラリ/プラグイン/フレームワークの調査をして結果を載せていきます。

実際にコードを書いて各ライブラリを触ってみたりして調査を進めていきます。


コードは下記コマンドで動きます。

```shell
npm run serve
# OR
yarn serve
```

---

### 欲しいグラフ

- 線
- 棒
- 棒のstacked
- 線と棒の Mixed / Combined

### 欲しい機能

- イベントの捕捉
  - 各データのクリックやハイライト
  - ラベルのクリック
- リアルタイムでの変化、アニメーション

## 調査候補のライブラリの一覧

ライセンス的に問題なく、基本的な棒グラフや線グラフなどに対応しているライブラリでそれなりに知名度のあるものを選びました。

- Chart.js
- Google Charts
- Chartist
- ApexCharts
- Highcharts（有料）
- C3.js
- plotly.js

### 候補から除外したもの

- D3.js
  - でかい。
- Three.js
  - WebGLで3DCGを描画できる。

メタでオーバーキルなライブラリは調査コスト、学習コストの面から除外しました。

## 機能の比較

|name|mixed|event|animation|comment|
|:--:|:---:|:---:|:-----:|:--:|
|Chart.js|◯|◯|◯|canvas / シンプル / デザイン◎|
|Google Charts|◯|◯|◯|google / OSSではない / WebAPI / クライアント側からgoogleのAPIにアクセスが必要|
|Chartist|×|△|◯|軽い / CSS Heavy / 機能は少ない / シンプル / デザイン◎|
|ApexCharts|◯|◯|◯|新しい / pngやsvgのダウンロードができる / シンプル / 新しいので知名度は低い / 直近のcommit頻度はかなり高いかも / デザイン◎|
|plotly.js|◯|◯|◯|D3.js based / グラフの種類がかなり多い / 複雑 |
|C3.js|◯|◯|◯|D3.js based / シンプル|
|Highcharts|◯|◯|◯|有料 / 多機能|

## 詳細レビュー

### Chart.js

- vue用のラッパーコンポーネントが何種類かある
  - とはいってもただvueのコンポーネント化してるだけなので、自分で素の`chart.js`触った方がブラックボックスが増えなくてよいかも

#### `Pros:`

- 有名
  - 他に比べると情報が多い
    - 日本語の情報もある
- reactiveに更新できる
- stacked barとlineのmixedもできる

#### `Cons:`

- 用意されていないことはできない。
- 情報が多いとは言っても公式documentに書かれてないことがあったりする（手が回ってない？）

### ApexCharts

#### `Pros:`

- 公式でVueのコンポーネントが用意されている
  - propsにパラメーターを渡して使う（データやオプションなど。イベントのハンドラーも渡せる）
  - 使い方はわりと簡単で、データの変更に対してもリアクティブ
  - オプションが豊富
    - ズーム、svgの書き出し、グリッドやツールチップのカスタマイズ、レジェンド機能など
    - すぐにいろんな機能が使える上、最初からアニメーションがついている
  - demoが豊富にあるためdemoにやりたいパターンがあればかなり容易に実装できる
  - コミット頻度が高く開発が盛んで、どんどん機能が追加されている(2019/02/21現在)
- reactiveに更新できる
- クリックしたデータ取得したりなどのイベント周りもわりと簡単にできる

#### `Cons:`

- 公式にAPI Referenceはあるが、それ以外の情報がほぼない
  - demoやreferenceにないことをやろうとすると困る
- **stacked barとlineのmixedができないっぽい（今の所）**
- 用意されている機能にdocumentが追いついていない
- まだ新しいため知名度が低い

### C3.js

- D3.js basedのグラフライブラリで、作者が日本人の方(Masayuki Tanakaさん)
  - > ただし公式に日本語ドキュメントはない
- vueのラッパーがある
  - > とはいってもvueのコンポーネント化しているだけなのでわざわざ使わなくても良さそう
- **注意点: CSSのインポートが必要！！**
  - 他のライブラリとは異なり、ライブラリ付属のcssを読み込む必要がある
  - svgのスタイルはcssで定義されており、このcssを読み込まないとグラフの見た目が期待通りの結果にならない
  - > 公式の一番最初に書いてあったものの、cssが必要なことに気がつくまでに時間がかかってしまった・・・😅

#### `Pros:`

- 使い方がシンプルで簡単
  - いままで一番シンプルで簡単だった
  - クリックされたデータの取得も簡単にできる！
    - 他のライブラリだとクリックされたデータのindexしかとれないけど、C3では最初からvalueもdataの名前などもとれる上に書き方がシンプルで簡単
- シンプルだけど高機能っぽい
- stacked bar + lineのmixedも簡単にできた
- **stackするグループを決められる**
- 日本語の情報もそこそこあり、知名度は結構高そう
- cssのクラスが付与されてsvgが出力されるので、クラスがついてるものについてはcssでスタイルをあてられる

#### `Cons:`

- 公式DocumentにExampleなどはたくさんあるけど細かい説明はない
  - かなりシンプルで簡単に使えるので説明が薄くてもそこまで困らないかも

### plotly.js

- [github](https://github.com/plotly/plotly.js)
- [公式サイト](https://plot.ly/plotly-js-scientific-d3-charting-library/)
- [公式ドキュメント](https://plot.ly/javascript/)
- d3 based
- Plotlyという会社がOSSとして公開しているchartライブラリ
  - R版やPython版もある
  - 統計とかデータの可視化に関してかなり強い会社の様子
  - 創業者はハーバードのドクターなど
- 規模が大きい。30種類以上のグラフがある
  - scientific charts
  - 3D graphs
  - statistical charts
  - SVG maps
  - financial charts
  - and more.

#### `Pros:`

- 3Dのグラフが描画ができる
- ズーム、pngダウンロードなど補助ツールが強力
- とにかくグラフの種類が多い
- 機能が豊富（比較した中では最多）でリッチ、公式ドキュメントが膨大
- 開発元の会社のバックグラウンドからして専門的な感じで統計やあらゆるデータの可視化に強い

#### `Cons:`

- とりあえず軽く使うには規模が大きく複雑
  - chart.jsやc3が500kb以下に対してこれは3MBくらいある（とはいっても部分的に使うことも可能っぽい）
- 使用者がちょっと少ない
- webpackでビルドする場合の注意が書いてあった（とりあえず今のところは問題なく使えている）


## 個人的に感じたこと、ハマったこと

vueでグラフライブラリを使って見て、特に深いことを考えず雑に作ったからこそ感じたことをまとめます。（グラフに限らず）

フロントエンドを仮に
- 「フロントエンド/フロントエンド」
- 「フロントエンド/バックエンド（vuexまわり）」

の二つに分けて考えたときに、「フロントエンド/フロントエンド」の状態管理については注意が必要と感じました（fluxのように一方通行ではない）

- vueインスタンスのdataプロパティやpropsのように値をセットできるところは注意してないと意図しない状態になっているかもしれない
  - > グラフが意図せず変わったりした😅

- 返り値がdataプロパティに依存しない作りのmethodsとかライフサイクルフックに関してはわりと安全
  - 不変にしたいものについてはdataプロパティじゃなくてmethodsが良さげ

- ネストしてる配列やオブジェクトのコピーに注意（当たり前？）
  - > deepコピーしたいなら`lodash.clonedeep`とかが無難そう

```js
const array1 = [[1,2],[1,2],[1,2]]
const copy1 = [...array1] // → deepコピーではない
const [a, b, c] = copy1
a[0] = 9 // array1[0][0]が影響を受ける

console.log(array1) // [ [ 9, 2 ], [ 1, 2 ], [ 1, 2 ] ]
```
